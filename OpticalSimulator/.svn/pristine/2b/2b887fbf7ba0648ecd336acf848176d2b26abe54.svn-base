package br.upe.simulations;

import br.upe.base.AmplifierType;
import br.upe.base.ACOPHeuristic;
import br.upe.base.ObjectiveFunction;
import br.upe.heuristics.lossComp.LossComp;
import br.upe.heuristics.maxGain.MaxGain;
import br.upe.heuristics.uiara.AdGC;
import br.upe.initializations.UniformInitialization;
import br.upe.initializations.UniformInitializationAMPVOA;
import br.upe.metrics.BeckerNoiseFigureMetric;
import br.upe.metrics.SimpleFlatnessMetric;
import br.upe.metrics.SumPowerConsumption;
import br.upe.objfunctions.rn.NNFunction;
import br.upe.selection.QuadraticSelection;
import br.upe.selection.UiaraWeightSelection;
import br.upe.simulations.simsetups.SimSetAMPVOA;
import br.upe.simulations.simsetups.SimulationSetup;
import br.upe.util.DecibelConverter;

public class SimAMPVOA {

	/**
	 * @param args
	 */
	public static void main(String[] args) {
		ACOPHeuristic heuristic;
		ObjectiveFunction function = new NNFunction();
		
		AmplifierType type = AmplifierType.L17_80CH;
		int rateCh = 10; //Gbps
		int numberCh = 10;
		switch(type){
		case L17_10CH:
			numberCh = 10;
			break;
		case L17_20CH:
			numberCh = 20;
			break;
		case L17_40CH:
			numberCh = 40;
			break;
		case L21_40CH:
			numberCh = 40;
			break;
		case L17_80CH:
			numberCh = 80;
			break;
		}

		SimulationSetup simSet = new SimSetAMPVOA(numberCh, -18.0f, 1f);
		float[] linLosses = simSet.getLINK_LOSSES();
		int numberAmplifiers = simSet.getNumberOfAmplifiers();
		
		//Definindo ganho máximo
		float maxPout = simSet.getMaxOutputPower();
		System.out.println(maxPout);
		
		float linkInputPower = DecibelConverter.calculateInputPower(simSet.getCHANNELS(), simSet.getCHANNEL_POWER());
		
		int runs = 1;

		for(int i=0; i<runs; i++){


			//LOSSCOMP
			long t1 = System.currentTimeMillis();
			heuristic = new LossComp(numberAmplifiers, linkInputPower, linLosses, function, 1);
			heuristic.setInitialization(new UniformInitialization(type));
			heuristic.setSelectionOp(new QuadraticSelection());
			heuristic.setFlatnessMetric(new SimpleFlatnessMetric());
			heuristic.setNoiseFigureMetric(new BeckerNoiseFigureMetric(linLosses));
			heuristic.setPowerConsumptionMetric(new SumPowerConsumption(numberCh, rateCh));
			heuristic.setVoaMaxAttenuation(simSet.getVOA_MAX_ATT());
			heuristic.setRoadmAttenuation(simSet.getROADM_ATT());
			heuristic.setMaxOutputPower(maxPout);

			heuristic.execute();

			System.out.println((System.currentTimeMillis() - t1));

			System.out.println(" ");
						
			//MaxGain
			t1 = System.currentTimeMillis();
			heuristic = new MaxGain(numberAmplifiers, linkInputPower, linLosses, function, 5);
			heuristic.setInitialization(new UniformInitialization(type));
			heuristic.setSelectionOp(new QuadraticSelection());
			heuristic.setFlatnessMetric(new SimpleFlatnessMetric());
			heuristic.setNoiseFigureMetric(new BeckerNoiseFigureMetric(linLosses));
			heuristic.setPowerConsumptionMetric(new SumPowerConsumption(numberCh, rateCh));
			heuristic.setVoaMaxAttenuation(simSet.getVOA_MAX_ATT());
			heuristic.setRoadmAttenuation(simSet.getROADM_ATT());
			heuristic.setMaxOutputPower(maxPout);

			heuristic.execute();

			System.out.println((System.currentTimeMillis() - t1));

			System.out.println(" ");
			
			//MaxGainAMPVOA
			t1 = System.currentTimeMillis();
			heuristic = new MaxGain(numberAmplifiers, linkInputPower, linLosses, function, 5);
			heuristic.setInitialization(new UniformInitializationAMPVOA(type));
			heuristic.setSelectionOp(new QuadraticSelection());
			heuristic.setFlatnessMetric(new SimpleFlatnessMetric());
			heuristic.setNoiseFigureMetric(new BeckerNoiseFigureMetric(linLosses));
			heuristic.setPowerConsumptionMetric(new SumPowerConsumption(numberCh, rateCh));
			heuristic.setVoaMaxAttenuation(20.0f);
			heuristic.setRoadmAttenuation(simSet.getROADM_ATT());
			heuristic.setMaxOutputPower(maxPout);

			heuristic.execute();

			System.out.println((System.currentTimeMillis() - t1));

			System.out.println(" ");
			
			//UIARA
			t1 = System.currentTimeMillis();
			heuristic = new AdGC(numberAmplifiers, linkInputPower, linLosses, function, 50);
			heuristic.setInitialization(new UniformInitialization(type));
			heuristic.setSelectionOp(new UiaraWeightSelection());
			heuristic.setFlatnessMetric(new SimpleFlatnessMetric());
			heuristic.setNoiseFigureMetric(new BeckerNoiseFigureMetric(linLosses));
			heuristic.setPowerConsumptionMetric(new SumPowerConsumption(numberCh, rateCh));
			heuristic.setVoaMaxAttenuation(simSet.getVOA_MAX_ATT());
			heuristic.setRoadmAttenuation(simSet.getROADM_ATT());
			heuristic.setMaxOutputPower(maxPout);


			// When the selection uses weight
			if (heuristic.getSelectionOp() instanceof UiaraWeightSelection) {
				((UiaraWeightSelection) heuristic.getSelectionOp())
				.setNFWeight(1);
				((UiaraWeightSelection) heuristic.getSelectionOp())
				.setGFWeight(0.5);
			}


			heuristic.execute();
			System.out.println((System.currentTimeMillis() - t1));
			
			//UIARA
			t1 = System.currentTimeMillis();
			heuristic = new AdGC(numberAmplifiers, linkInputPower, linLosses, function, 50);
			heuristic.setInitialization(new UniformInitializationAMPVOA(type));
			heuristic.setSelectionOp(new UiaraWeightSelection());
			heuristic.setFlatnessMetric(new SimpleFlatnessMetric());
			heuristic.setNoiseFigureMetric(new BeckerNoiseFigureMetric(linLosses));
			heuristic.setPowerConsumptionMetric(new SumPowerConsumption(numberCh, rateCh));
			heuristic.setVoaMaxAttenuation(simSet.getVOA_MAX_ATT());
			heuristic.setRoadmAttenuation(simSet.getROADM_ATT());
			heuristic.setMaxOutputPower(maxPout);


			// When the selection uses weight
			if (heuristic.getSelectionOp() instanceof UiaraWeightSelection) {
				((UiaraWeightSelection) heuristic.getSelectionOp())
				.setNFWeight(1);
				((UiaraWeightSelection) heuristic.getSelectionOp())
				.setGFWeight(0.5);
			}


			heuristic.execute();
			System.out.println((System.currentTimeMillis() - t1));

		}


		//System.out.println("\n\n");
	}

}
